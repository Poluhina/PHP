<?php
/**
 * Скрипт для добавления списка фильмов в базу данных.
 * Данные фильмов вставляются в таблицу movies с использованием подготовленных выражений.
 *
 *
 * @category DatabaseInteraction
 * @package  MovieCatalogApp
 * @author   
 */

// Подключение к базе данных
$mysqli = new mysqli("localhost", "root", "", "movie_catalog");

/**
 * Проверка на успешное подключение к базе данных.
 * В случае ошибки подключения, скрипт завершится.
 */
if ($mysqli->connect_errno) {
    die("Ошибка подключения: " . $mysqli->connect_error);
}

// Данные фильмов для добавления в базу данных
$movies = [
    ["Дюна", "Эпическая фантастика о борьбе за пустынную планету и судьбу человечества.", "Фантастика"],
    ["Интерстеллар", "Команда исследователей отправляется через червоточину в поисках нового дома для человечества.", "Научная фантастика"],
    ["Начало", "Мастер снов проникает в сознание людей, чтобы украсть или внедрить идеи.", "Триллер"],
    ["Амели", "Добрая и мечтательная девушка решает сделать людей вокруг счастливее.", "Комедия"]
];

/**
 * Подготовленный запрос для вставки данных фильмов в таблицу movies.
 * Используются параметры: title, description, genre.
 */
$query = "INSERT INTO movies (title, description, genre) VALUES (?, ?, ?)";

// Подготовка запроса
$stmt = $mysqli->prepare($query);

/**
 * Проверка на ошибки при подготовке запроса.
 * Если подготовка не удалась, скрипт завершится с ошибкой.
 */
if ($stmt === false) {
    die('Ошибка подготовки запроса: ' . $mysqli->error);
}

// Цикл для вставки каждого фильма в базу данных
foreach ($movies as $movie) {
    /**
     * Экранирование данных перед вставкой в запрос.
     * Это защита от SQL-инъекций.
     */
    $title = $mysqli->real_escape_string($movie[0]);
    $description = $mysqli->real_escape_string($movie[1]);
    $genre = $mysqli->real_escape_string($movie[2]);

    /**
     * Привязка значений к параметрам подготовленного запроса.
     * Параметры запроса: строка для title, строка для description, строка для genre.
     */
    $stmt->bind_param("sss", $title, $description, $genre);

    /**
     * Выполнение запроса для добавления фильма в базу данных.
     * Если запрос не выполняется, будет выведена ошибка.
     */
    if (!$stmt->execute()) {
        echo "Ошибка при добавлении фильма: " . $stmt->error . "<br>";
    }
}

// Вывод сообщения об успешном добавлении данных
echo "Фильмы успешно добавлены!";

// Закрытие подготовленного запроса и соединения с базой данных
$stmt->close();
$mysqli->close();
?>

